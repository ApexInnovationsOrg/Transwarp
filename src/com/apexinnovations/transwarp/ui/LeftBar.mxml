<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx" height="100%" xmlns:sparkTree="com.sparkTree.*" xmlns:tree="com.apexinnovations.transwarp.ui.tree.*">
	
	<fx:Metadata>
		[Event(name="pageSelectionChanged", type="com.apexinnovations.transwarp.application.events.PageSelectionEvent")]
	</fx:Metadata>
	
	<fx:Script>
		<![CDATA[
			import com.apexinnovations.transwarp.application.events.PageSelectionEvent;
			import com.apexinnovations.transwarp.ui.tree.XMLLinearIList;
			
			protected var _productData:XML;

			public function get productData():XML {
				return _productData;
				
			}
			
			public function set productData(value:XML):void {
				value = value.copy(); 		// Ensure that no changes to the structure propagate up.
				preProcess(value);				
				tree.dataProvider = new XMLLinearIList(value, []);
				_productData = value;
			}

			protected function preProcess(xml:XML):void {
				if(xml.localName() == "page")
					delete xml.*;			// Trim children of page nodes since they need to be the leaves for this tree.
				
				xml.@visited = "false";
				
				if(xml.children().length() > 0)
					for each(var child:XML in xml.children())
					preProcess(child);
			}
			
			protected function selectionChange():void {
				var data:XML = XML(tree.selectedItem);
				dispatchEvent(new PageSelectionEvent(data.@id));
			}
			
		]]>
	</fx:Script>
	
	<s:Rect top="0" topRightRadiusX="10" bottomRightRadiusX="10" width="100%" height="100%">
		<!--<s:stroke>
			<s:SolidColorStroke color="0x000000" />
		</s:stroke>-->
		<s:fill>
			<s:SolidColor color="0x9999aa"/>
		</s:fill>
	</s:Rect>
		
	<tree:Tree id="tree" top="10" bottom="10" right="20" left="5" minWidth="300" change="selectionChange()"/>
		
	<s:filters>
		<s:DropShadowFilter alpha=".5" />
	</s:filters>
	
</s:Group>
